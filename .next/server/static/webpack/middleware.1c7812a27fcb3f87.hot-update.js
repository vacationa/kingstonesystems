"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.ts":
/*!***********************!*\
  !*** ./middleware.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/ssr */ \"(middleware)/./node_modules/@supabase/ssr/dist/module/index.js\");\n\n\nconst config = {\n    matcher: [\n        /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public folder\n     */ \"/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)\"\n    ]\n};\n// Middleware helper function\nconst updateSession = async (request)=>{\n    try {\n        // Block public pages first - return 404 (before any session processing)\n        const blockedRoutes = [\n            \"/pricing\",\n            \"/terms\",\n            \"/privacy\"\n        ];\n        const isBlockedRoute = blockedRoutes.some((route)=>request.nextUrl.pathname === route || request.nextUrl.pathname.startsWith(`${route}/`));\n        if (isBlockedRoute) {\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(\"Not Found\", {\n                status: 404\n            });\n        }\n        // Create a response object that we can modify\n        let response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next({\n            request: {\n                headers: request.headers\n            }\n        });\n        const supabase = (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_1__.createServerClient)(\"https://jtnyrkqxsrlbldbnsohf.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp0bnlya3F4c3JsYmxkYm5zb2hmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5MzI3NTgsImV4cCI6MjA2NTUwODc1OH0.tnLvT4n4aQela3pUHUnvOHIwvY_Twfr9T-Fplyul4Ug\", {\n            cookies: {\n                get (name) {\n                    return request.cookies.get(name)?.value;\n                },\n                set (name, value, options) {\n                    response.cookies.set({\n                        name,\n                        value,\n                        ...options\n                    });\n                },\n                remove (name, options) {\n                    response.cookies.set({\n                        name,\n                        value: \"\",\n                        ...options\n                    });\n                }\n            }\n        });\n        // Refresh the session if it exists\n        await supabase.auth.getSession();\n        // Auth pages that should redirect to dashboard if user is logged in\n        // NOTE: /sign-in is the dummy client portal â€” intentionally excluded so it\n        // always renders regardless of session. Only /operator-login redirects.\n        const authPages = [\n            \"/operator-login\"\n        ];\n        const isAuthPage = authPages.some((page)=>request.nextUrl.pathname.startsWith(page));\n        // Get the session - if null, the user is not logged in\n        const { data: { session } } = await supabase.auth.getSession();\n        // If on auth page and have session, redirect to dashboard\n        if (isAuthPage && session) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/dashboard\", request.url));\n        }\n        // If accessing dashboard without session, redirect to sign-in\n        if (request.nextUrl.pathname.startsWith(\"/dashboard\") && !session) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/sign-in\", request.url));\n        }\n        return response;\n    } catch (error) {\n        console.error(\"Session update error:\", error);\n        // For dashboard routes, redirect to sign-in on error\n        if (request.nextUrl.pathname.startsWith(\"/dashboard\")) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/sign-in\", request.url));\n        }\n        // For other routes, proceed\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n};\nasync function middleware(request) {\n    // Skip middleware for static files and images\n    if (request.nextUrl.pathname.match(/\\.(js|css|ico|png|jpg|svg)$/)) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // Block public pages immediately - return 404 (before any processing)\n    const blockedRoutes = [\n        \"/pricing\",\n        \"/terms\",\n        \"/privacy\"\n    ];\n    const pathname = request.nextUrl.pathname;\n    const isBlockedRoute = blockedRoutes.some((route)=>pathname === route || pathname.startsWith(`${route}/`));\n    if (isBlockedRoute) {\n        // Return 404 with proper headers\n        return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(\"Not Found\", {\n            status: 404,\n            statusText: \"Not Found\",\n            headers: {\n                \"Content-Type\": \"text/plain\"\n            }\n        });\n    }\n    try {\n        // First update the session\n        const sessionResponse = await updateSession(request);\n        // If we got a redirect or 404 response, return it\n        if (sessionResponse.headers.get(\"location\") || sessionResponse.status === 404) {\n            return sessionResponse;\n        }\n        const photosEndpoint = \"/api/generate-photo\";\n        // For API endpoints, ensure authentication\n        if (request.nextUrl.pathname.startsWith(\"/api\")) {\n            const supabase = (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_1__.createServerClient)(\"https://jtnyrkqxsrlbldbnsohf.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp0bnlya3F4c3JsYmxkYm5zb2hmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5MzI3NTgsImV4cCI6MjA2NTUwODc1OH0.tnLvT4n4aQela3pUHUnvOHIwvY_Twfr9T-Fplyul4Ug\", {\n                cookies: {\n                    get (name) {\n                        return request.cookies.get(name)?.value;\n                    },\n                    set (name, value, options) {\n                    // We don't need to set cookies for API routes\n                    },\n                    remove (name, options) {\n                    // We don't need to remove cookies for API routes\n                    }\n                }\n            });\n            const { data: { session } } = await supabase.auth.getSession();\n            if (!session) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Unauthorized\"\n                }, {\n                    status: 401\n                });\n            }\n            // Rate limiting for specific endpoints\n            if (request.nextUrl.pathname.startsWith(photosEndpoint)) {\n                // Implement rate limiting logic here if needed\n                return sessionResponse;\n            }\n        }\n        return sessionResponse;\n    } catch (error) {\n        console.error(\"Middleware error:\", error);\n        // For API routes, return 401\n        if (request.nextUrl.pathname.startsWith(\"/api\")) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Authentication error\"\n            }, {\n                status: 401\n            });\n        }\n        // For other routes, proceed\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FBc0I7b0JBQ3pDLGlEQUFpRDtvQkFDbkQ7Z0JBQ0Y7WUFDRjtZQUdGLE1BQU0sRUFDSk8sTUFBTSxFQUFFQyxPQUFPLEVBQUUsRUFDbEIsR0FBRyxNQUFNbEIsU0FBU1ksSUFBSSxDQUFDQyxVQUFVO1lBRWxDLElBQUksQ0FBQ0ssU0FBUztnQkFDWixPQUFPbkMscURBQVlBLENBQUM4QyxJQUFJLENBQUM7b0JBQUVQLE9BQU87Z0JBQWUsR0FBRztvQkFBRTFCLFFBQVE7Z0JBQUk7WUFDcEU7WUFFQSx1Q0FBdUM7WUFDdkMsSUFBSVIsUUFBUUssT0FBTyxDQUFDQyxRQUFRLENBQUNDLFVBQVUsQ0FBQ2lDLGlCQUFpQjtnQkFDdkQsK0NBQStDO2dCQUMvQyxPQUFPRDtZQUNUO1FBQ0Y7UUFFQSxPQUFPQTtJQUNULEVBQUUsT0FBT0wsT0FBWTtRQUNuQkMsUUFBUUQsS0FBSyxDQUFDLHFCQUFxQkE7UUFFbkMsNkJBQTZCO1FBQzdCLElBQUlsQyxRQUFRSyxPQUFPLENBQUNDLFFBQVEsQ0FBQ0MsVUFBVSxDQUFDLFNBQVM7WUFDL0MsT0FBT1oscURBQVlBLENBQUM4QyxJQUFJLENBQUM7Z0JBQUVQLE9BQU87WUFBdUIsR0FBRztnQkFBRTFCLFFBQVE7WUFBSTtRQUM1RTtRQUVBLDRCQUE0QjtRQUM1QixPQUFPYixxREFBWUEsQ0FBQ2UsSUFBSTtJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvYWRoaS9SZXBvcy9raW5nc3RvbmVzeXN0ZW1zL21pZGRsZXdhcmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHlwZSBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XG5pbXBvcnQgeyBjcmVhdGVTZXJ2ZXJDbGllbnQsIHR5cGUgQ29va2llT3B0aW9ucyB9IGZyb20gXCJAc3VwYWJhc2Uvc3NyXCI7XG5cbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XG4gIG1hdGNoZXI6IFtcbiAgICAvKlxuICAgICAqIE1hdGNoIGFsbCByZXF1ZXN0IHBhdGhzIGV4Y2VwdCBmb3IgdGhlIG9uZXMgc3RhcnRpbmcgd2l0aDpcbiAgICAgKiAtIF9uZXh0L3N0YXRpYyAoc3RhdGljIGZpbGVzKVxuICAgICAqIC0gX25leHQvaW1hZ2UgKGltYWdlIG9wdGltaXphdGlvbiBmaWxlcylcbiAgICAgKiAtIGZhdmljb24uaWNvIChmYXZpY29uIGZpbGUpXG4gICAgICogLSBwdWJsaWMgZm9sZGVyXG4gICAgICovXG4gICAgXCIvKCg/IV9uZXh0L3N0YXRpY3xfbmV4dC9pbWFnZXxmYXZpY29uLmljb3wuKlxcXFwuKD86c3ZnfHBuZ3xqcGd8anBlZ3xnaWZ8d2VicCkkKS4qKVwiLFxuICBdLFxufTtcblxuLy8gTWlkZGxld2FyZSBoZWxwZXIgZnVuY3Rpb25cbmNvbnN0IHVwZGF0ZVNlc3Npb24gPSBhc3luYyAocmVxdWVzdDogTmV4dFJlcXVlc3QpID0+IHtcbiAgdHJ5IHtcbiAgICAvLyBCbG9jayBwdWJsaWMgcGFnZXMgZmlyc3QgLSByZXR1cm4gNDA0IChiZWZvcmUgYW55IHNlc3Npb24gcHJvY2Vzc2luZylcbiAgICBjb25zdCBibG9ja2VkUm91dGVzID0gW1xuICAgICAgXCIvcHJpY2luZ1wiLFxuICAgICAgXCIvdGVybXNcIixcbiAgICAgIFwiL3ByaXZhY3lcIixcbiAgICBdO1xuXG4gICAgY29uc3QgaXNCbG9ja2VkUm91dGUgPSBibG9ja2VkUm91dGVzLnNvbWUoKHJvdXRlKSA9PlxuICAgICAgcmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lID09PSByb3V0ZSB8fCByZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aChgJHtyb3V0ZX0vYClcbiAgICApO1xuXG4gICAgaWYgKGlzQmxvY2tlZFJvdXRlKSB7XG4gICAgICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShcIk5vdCBGb3VuZFwiLCB7IHN0YXR1czogNDA0IH0pO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBhIHJlc3BvbnNlIG9iamVjdCB0aGF0IHdlIGNhbiBtb2RpZnlcbiAgICBsZXQgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCh7XG4gICAgICByZXF1ZXN0OiB7XG4gICAgICAgIGhlYWRlcnM6IHJlcXVlc3QuaGVhZGVycyxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZVNlcnZlckNsaWVudChcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSEsXG4gICAgICB7XG4gICAgICAgIGNvb2tpZXM6IHtcbiAgICAgICAgICBnZXQobmFtZTogc3RyaW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdC5jb29raWVzLmdldChuYW1lKT8udmFsdWU7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXQobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBvcHRpb25zOiBDb29raWVPcHRpb25zKSB7XG4gICAgICAgICAgICByZXNwb25zZS5jb29raWVzLnNldCh7XG4gICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZW1vdmUobmFtZTogc3RyaW5nLCBvcHRpb25zOiBDb29raWVPcHRpb25zKSB7XG4gICAgICAgICAgICByZXNwb25zZS5jb29raWVzLnNldCh7XG4gICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgIHZhbHVlOiBcIlwiLFxuICAgICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIC8vIFJlZnJlc2ggdGhlIHNlc3Npb24gaWYgaXQgZXhpc3RzXG4gICAgYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRTZXNzaW9uKCk7XG5cbiAgICAvLyBBdXRoIHBhZ2VzIHRoYXQgc2hvdWxkIHJlZGlyZWN0IHRvIGRhc2hib2FyZCBpZiB1c2VyIGlzIGxvZ2dlZCBpblxuICAgIC8vIE5PVEU6IC9zaWduLWluIGlzIHRoZSBkdW1teSBjbGllbnQgcG9ydGFsIOKAlCBpbnRlbnRpb25hbGx5IGV4Y2x1ZGVkIHNvIGl0XG4gICAgLy8gYWx3YXlzIHJlbmRlcnMgcmVnYXJkbGVzcyBvZiBzZXNzaW9uLiBPbmx5IC9vcGVyYXRvci1sb2dpbiByZWRpcmVjdHMuXG4gICAgY29uc3QgYXV0aFBhZ2VzID0gW1wiL29wZXJhdG9yLWxvZ2luXCJdO1xuICAgIGNvbnN0IGlzQXV0aFBhZ2UgPSBhdXRoUGFnZXMuc29tZSgocGFnZSkgPT4gcmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgocGFnZSkpO1xuXG4gICAgLy8gR2V0IHRoZSBzZXNzaW9uIC0gaWYgbnVsbCwgdGhlIHVzZXIgaXMgbm90IGxvZ2dlZCBpblxuICAgIGNvbnN0IHtcbiAgICAgIGRhdGE6IHsgc2Vzc2lvbiB9LFxuICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFNlc3Npb24oKTtcblxuICAgIC8vIElmIG9uIGF1dGggcGFnZSBhbmQgaGF2ZSBzZXNzaW9uLCByZWRpcmVjdCB0byBkYXNoYm9hcmRcbiAgICBpZiAoaXNBdXRoUGFnZSAmJiBzZXNzaW9uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoXCIvZGFzaGJvYXJkXCIsIHJlcXVlc3QudXJsKSk7XG4gICAgfVxuXG4gICAgLy8gSWYgYWNjZXNzaW5nIGRhc2hib2FyZCB3aXRob3V0IHNlc3Npb24sIHJlZGlyZWN0IHRvIHNpZ24taW5cbiAgICBpZiAocmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvZGFzaGJvYXJkXCIpICYmICFzZXNzaW9uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoXCIvc2lnbi1pblwiLCByZXF1ZXN0LnVybCkpO1xuICAgIH1cblxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2Vzc2lvbiB1cGRhdGUgZXJyb3I6XCIsIGVycm9yKTtcblxuICAgIC8vIEZvciBkYXNoYm9hcmQgcm91dGVzLCByZWRpcmVjdCB0byBzaWduLWluIG9uIGVycm9yXG4gICAgaWYgKHJlcXVlc3QubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKFwiL2Rhc2hib2FyZFwiKSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKFwiL3NpZ24taW5cIiwgcmVxdWVzdC51cmwpKTtcbiAgICB9XG5cbiAgICAvLyBGb3Igb3RoZXIgcm91dGVzLCBwcm9jZWVkXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XG4gIH1cbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtaWRkbGV3YXJlKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIC8vIFNraXAgbWlkZGxld2FyZSBmb3Igc3RhdGljIGZpbGVzIGFuZCBpbWFnZXNcbiAgaWYgKHJlcXVlc3QubmV4dFVybC5wYXRobmFtZS5tYXRjaCgvXFwuKGpzfGNzc3xpY298cG5nfGpwZ3xzdmcpJC8pKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XG4gIH1cblxuICAvLyBCbG9jayBwdWJsaWMgcGFnZXMgaW1tZWRpYXRlbHkgLSByZXR1cm4gNDA0IChiZWZvcmUgYW55IHByb2Nlc3NpbmcpXG4gIGNvbnN0IGJsb2NrZWRSb3V0ZXMgPSBbXG4gICAgXCIvcHJpY2luZ1wiLFxuICAgIFwiL3Rlcm1zXCIsXG4gICAgXCIvcHJpdmFjeVwiLFxuICBdO1xuXG4gIGNvbnN0IHBhdGhuYW1lID0gcmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lO1xuICBjb25zdCBpc0Jsb2NrZWRSb3V0ZSA9IGJsb2NrZWRSb3V0ZXMuc29tZSgocm91dGUpID0+XG4gICAgcGF0aG5hbWUgPT09IHJvdXRlIHx8IHBhdGhuYW1lLnN0YXJ0c1dpdGgoYCR7cm91dGV9L2ApXG4gICk7XG5cbiAgaWYgKGlzQmxvY2tlZFJvdXRlKSB7XG4gICAgLy8gUmV0dXJuIDQwNCB3aXRoIHByb3BlciBoZWFkZXJzXG4gICAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2UoXCJOb3QgRm91bmRcIiwge1xuICAgICAgc3RhdHVzOiA0MDQsXG4gICAgICBzdGF0dXNUZXh0OiBcIk5vdCBGb3VuZFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcInRleHQvcGxhaW5cIixcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICB0cnkge1xuICAgIC8vIEZpcnN0IHVwZGF0ZSB0aGUgc2Vzc2lvblxuICAgIGNvbnN0IHNlc3Npb25SZXNwb25zZSA9IGF3YWl0IHVwZGF0ZVNlc3Npb24ocmVxdWVzdCk7XG5cbiAgICAvLyBJZiB3ZSBnb3QgYSByZWRpcmVjdCBvciA0MDQgcmVzcG9uc2UsIHJldHVybiBpdFxuICAgIGlmIChzZXNzaW9uUmVzcG9uc2UuaGVhZGVycy5nZXQoXCJsb2NhdGlvblwiKSB8fCBzZXNzaW9uUmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHtcbiAgICAgIHJldHVybiBzZXNzaW9uUmVzcG9uc2U7XG4gICAgfVxuXG4gICAgY29uc3QgcGhvdG9zRW5kcG9pbnQgPSBcIi9hcGkvZ2VuZXJhdGUtcGhvdG9cIjtcblxuICAgIC8vIEZvciBBUEkgZW5kcG9pbnRzLCBlbnN1cmUgYXV0aGVudGljYXRpb25cbiAgICBpZiAocmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvYXBpXCIpKSB7XG4gICAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZVNlcnZlckNsaWVudChcbiAgICAgICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMISxcbiAgICAgICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhLFxuICAgICAgICB7XG4gICAgICAgICAgY29va2llczoge1xuICAgICAgICAgICAgZ2V0KG5hbWU6IHN0cmluZykge1xuICAgICAgICAgICAgICByZXR1cm4gcmVxdWVzdC5jb29raWVzLmdldChuYW1lKT8udmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0KG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgb3B0aW9uczogQ29va2llT3B0aW9ucykge1xuICAgICAgICAgICAgICAvLyBXZSBkb24ndCBuZWVkIHRvIHNldCBjb29raWVzIGZvciBBUEkgcm91dGVzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVtb3ZlKG5hbWU6IHN0cmluZywgb3B0aW9uczogQ29va2llT3B0aW9ucykge1xuICAgICAgICAgICAgICAvLyBXZSBkb24ndCBuZWVkIHRvIHJlbW92ZSBjb29raWVzIGZvciBBUEkgcm91dGVzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICApO1xuXG4gICAgICBjb25zdCB7XG4gICAgICAgIGRhdGE6IHsgc2Vzc2lvbiB9LFxuICAgICAgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0U2Vzc2lvbigpO1xuXG4gICAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUmF0ZSBsaW1pdGluZyBmb3Igc3BlY2lmaWMgZW5kcG9pbnRzXG4gICAgICBpZiAocmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgocGhvdG9zRW5kcG9pbnQpKSB7XG4gICAgICAgIC8vIEltcGxlbWVudCByYXRlIGxpbWl0aW5nIGxvZ2ljIGhlcmUgaWYgbmVlZGVkXG4gICAgICAgIHJldHVybiBzZXNzaW9uUmVzcG9uc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlc3Npb25SZXNwb25zZTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJNaWRkbGV3YXJlIGVycm9yOlwiLCBlcnJvcik7XG5cbiAgICAvLyBGb3IgQVBJIHJvdXRlcywgcmV0dXJuIDQwMVxuICAgIGlmIChyZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aChcIi9hcGlcIikpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIkF1dGhlbnRpY2F0aW9uIGVycm9yXCIgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICB9XG5cbiAgICAvLyBGb3Igb3RoZXIgcm91dGVzLCBwcm9jZWVkXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNyZWF0ZVNlcnZlckNsaWVudCIsImNvbmZpZyIsIm1hdGNoZXIiLCJ1cGRhdGVTZXNzaW9uIiwicmVxdWVzdCIsImJsb2NrZWRSb3V0ZXMiLCJpc0Jsb2NrZWRSb3V0ZSIsInNvbWUiLCJyb3V0ZSIsIm5leHRVcmwiLCJwYXRobmFtZSIsInN0YXJ0c1dpdGgiLCJzdGF0dXMiLCJyZXNwb25zZSIsIm5leHQiLCJoZWFkZXJzIiwic3VwYWJhc2UiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJjb29raWVzIiwiZ2V0IiwibmFtZSIsInZhbHVlIiwic2V0Iiwib3B0aW9ucyIsInJlbW92ZSIsImF1dGgiLCJnZXRTZXNzaW9uIiwiYXV0aFBhZ2VzIiwiaXNBdXRoUGFnZSIsInBhZ2UiLCJkYXRhIiwic2Vzc2lvbiIsInJlZGlyZWN0IiwiVVJMIiwidXJsIiwiZXJyb3IiLCJjb25zb2xlIiwibWlkZGxld2FyZSIsIm1hdGNoIiwic3RhdHVzVGV4dCIsInNlc3Npb25SZXNwb25zZSIsInBob3Rvc0VuZHBvaW50IiwianNvbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(middleware)/./middleware.ts\n");

/***/ })

});